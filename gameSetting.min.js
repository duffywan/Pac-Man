angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$log","realTimeService","randomService",function(){function a(a){isOngoing||y.newGame(),console.log("start match"),isOngoing=!0;var b=a.yourPlayerIndex,c=a.playersInfo,d=c.length;realTimeSimpleService.sendReliableMessage("Reliable"),realTimeSimpleService.sendUnreliableMessage("Unreliable"),console.log("gotStartMatch: yourPlayerIndex="+b+" numberOfPlayers="+d);for(var e=[],f=0;d>f;f++)e.push(42)}function b(a){var b=a.fromPlayerIndex,c=a.message;console.log("msg="+c+" from "+b)}function c(a){console.log("gotEndMatch:"+a)}function d(d){window.realTimeSimpleService=d,console.log("init"),d.init({gotStartMatch:a,gotMessage:b,gotEndMatch:c})}function e(){setTimeout(f,30)}function f(){var a=(new Date).getTime();$.ajax({datatype:"json",type:"GET",url:"data/db-handler.php",data:{timestamp:a,action:"get"},success:function(a){$("#highscore-list").text("");for(var b=0;b<a.length;b++)$("#highscore-list").append("<li>"+a[b].name+"<span id='score'>"+a[b].score+"</span></li>")}})}function g(a,b){$.ajax({type:"POST",url:"data/db-handler.php",data:{action:"add",name:a,score:b}})}function h(){g($("input[type=text]").val(),y.score.score),$("#highscore-form").html('<span class="button" onClick="game.showContent(\'highscore-content\');getHighscore();">view highscore</span>')}function i(a,b,c,d,e){console.log("BuildWall"),d=2*d-1,e=2*e-1,a.fillRect(q.radius/2+2*b*q.radius,q.radius/2+2*c*q.radius,d*q.radius,e*q.radius)}function j(a,b,c){return a>=b&&c>=a}function k(){this.refreshRate=33,this.running=!1,this.pause=!0,this.score=new l,this.soundfx=0,this.map,this.pillCount,this.monsters,this.level=1,this.gameOver=!1,this.canvas=$("#myCanvas").get(0),this.width=this.canvas.width,this.height=this.canvas.height,window.tmpcanvas=this.canvas,this.ghostFrightened=!1,this.ghostFrightenedTimer=240,this.ghostMode=0,this.ghostModeTimer=200,this.startGhostFrightened=function(){console.log("ghost frigthened"),this.ghostFrightened=!0,this.ghostFrightenedTimer=240,B.dazzle(),E.dazzle(),C.dazzle(),D.dazzle()},this.endGhostFrightened=function(){console.log("ghost frigthened end"),this.ghostFrightened=!1,B.undazzle(),E.undazzle(),C.undazzle(),D.undazzle()},this.checkGhostMode=function(){this.ghostFrightened?(this.ghostFrightenedTimer--,0==this.ghostFrightenedTimer&&(this.endGhostFrightened(),this.ghostFrigthenedTimer=240)):(this.ghostModeTimer--,0==this.ghostModeTimer&&(console.log("ghostMode="+this.ghostMode),this.ghostMode^=1,this.ghostModeTimer=200+450*this.ghostMode))},this.getMapContent=function(a,b){var c=y.width/30-1,d=y.height/30-1;return 0>a&&(a=c+a),a>c&&(a-=c),0>b&&(b=d+b),b>d&&(b-=d),this.map.posY[b].posX[a].type},this.setMapContent=function(a,b,c){this.map.posY[b].posX[a].type=c},this.toggleSound=function(){this.soundfx=0==this.soundfx?1:0,$("#mute").toggle()},this.reset=function(){},this.newGame=function(){this.init(0),this.pauseResume()},this.nextLevel=function(){this.level++,console.log("Level "+y.level),y.showMessage("Level "+y.level,"Level up! Click to continue!"),this.init(1)},this.drawHearts=function(a){var b,c="";for(b=0;a>b;b++)c+=" <img src='imgs/heart.png'>";$(".lives").html("Lives: "+c)},this.showContent=function(a){$(".content").hide(),$("#"+a).show()},this.showMessage=function(a,b){this.pause=!0,$("#canvas-overlay-container").fadeIn(200),"none"!=$(".controls").css("display")&&$(".controls").slideToggle(200),$("#canvas-overlay-content #title").text(a),$("#canvas-overlay-content #text").html(b)},this.closeMessage=function(){$("#canvas-overlay-container").fadeOut(200),$(".controls").slideToggle(200)},this.pauseResume=function(){this.running||(this.pause=!1,this.running=!0,this.closeMessage(),u())},this.init=function(a){console.log("init game "+a),y.map={posY:[{row:1,posX:[{col:1,type:"wall"},{col:2,type:"wall"},{col:3,type:"wall"},{col:4,type:"wall"},{col:5,type:"wall"},{col:6,type:"wall"},{col:7,type:"wall"},{col:8,type:"wall"},{col:9,type:"wall"},{col:10,type:"wall"},{col:11,type:"wall"},{col:12,type:"wall"},{col:13,type:"wall"},{col:14,type:"wall"},{col:15,type:"wall"},{col:16,type:"wall"},{col:17,type:"wall"},{col:18,type:"wall"}]},{row:2,posX:[{col:1,type:"wall"},{col:2,type:"powerpill"},{col:3,type:"pill"},{col:4,type:"pill"},{col:5,type:"wall"},{col:6,type:"pill"},{col:7,type:"pill"},{col:8,type:"pill"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"pill"},{col:12,type:"pill"},{col:13,type:"pill"},{col:14,type:"wall"},{col:15,type:"pill"},{col:16,type:"pill"},{col:17,type:"powerpill"},{col:18,type:"wall"}]},{row:3,posX:[{col:1,type:"wall"},{col:2,type:"pill"},{col:3,type:"wall"},{col:4,type:"pill"},{col:5,type:"pill"},{col:6,type:"pill"},{col:7,type:"wall"},{col:8,type:"wall"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"wall"},{col:12,type:"wall"},{col:13,type:"pill"},{col:14,type:"pill"},{col:15,type:"pill"},{col:16,type:"wall"},{col:17,type:"pill"},{col:18,type:"wall"}]},{row:4,posX:[{col:1,type:"wall"},{col:2,type:"pill"},{col:3,type:"wall"},{col:4,type:"wall"},{col:5,type:"pill"},{col:6,type:"wall"},{col:7,type:"pill"},{col:8,type:"pill"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"pill"},{col:12,type:"pill"},{col:13,type:"wall"},{col:14,type:"pill"},{col:15,type:"wall"},{col:16,type:"wall"},{col:17,type:"pill"},{col:18,type:"wall"}]},{row:5,posX:[{col:1,type:"wall"},{col:2,type:"pill"},{col:3,type:"pill"},{col:4,type:"wall"},{col:5,type:"pill"},{col:6,type:"pill"},{col:7,type:"pill"},{col:8,type:"wall"},{col:9,type:"door"},{col:10,type:"door"},{col:11,type:"wall"},{col:12,type:"pill"},{col:13,type:"pill"},{col:14,type:"pill"},{col:15,type:"wall"},{col:16,type:"pill"},{col:17,type:"pill"},{col:18,type:"wall"}]},{row:6,posX:[{col:1,type:"wall"},{col:2,type:"wall"},{col:3,type:"pill"},{col:4,type:"wall"},{col:5,type:"wall"},{col:6,type:"pill"},{col:7,type:"wall"},{col:8,type:"null"},{col:9,type:"null"},{col:10,type:"null"},{col:11,type:"null"},{col:12,type:"wall"},{col:13,type:"pill"},{col:14,type:"wall"},{col:15,type:"wall"},{col:16,type:"pill"},{col:17,type:"wall"},{col:18,type:"wall"}]},{row:7,posX:[{col:1,type:"pill"},{col:2,type:"pill"},{col:3,type:"pill"},{col:4,type:"pill"},{col:5,type:"pill"},{col:6,type:"pill"},{col:7,type:"wall"},{col:8,type:"wall"},{col:9,type:"wall"},{col:10,type:"wall"},{col:11,type:"wall"},{col:12,type:"wall"},{col:13,type:"pill"},{col:14,type:"pill"},{col:15,type:"pill"},{col:16,type:"pill"},{col:17,type:"pill"},{col:18,type:"pill"}]},{row:8,posX:[{col:1,type:"wall"},{col:2,type:"wall"},{col:3,type:"pill"},{col:4,type:"wall"},{col:5,type:"wall"},{col:6,type:"pill"},{col:7,type:"pill"},{col:8,type:"pill"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"pill"},{col:12,type:"pill"},{col:13,type:"pill"},{col:14,type:"wall"},{col:15,type:"wall"},{col:16,type:"pill"},{col:17,type:"wall"},{col:18,type:"wall"}]},{row:9,posX:[{col:1,type:"wall"},{col:2,type:"wall"},{col:3,type:"pill"},{col:4,type:"wall"},{col:5,type:"wall"},{col:6,type:"wall"},{col:7,type:"wall"},{col:8,type:"wall"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"wall"},{col:12,type:"wall"},{col:13,type:"wall"},{col:14,type:"wall"},{col:15,type:"wall"},{col:16,type:"pill"},{col:17,type:"wall"},{col:18,type:"wall"}]},{row:10,posX:[{col:1,type:"wall"},{col:2,type:"pill"},{col:3,type:"pill"},{col:4,type:"pill"},{col:5,type:"wall"},{col:6,type:"wall"},{col:7,type:"pill"},{col:8,type:"pill"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"pill"},{col:12,type:"pill"},{col:13,type:"wall"},{col:14,type:"wall"},{col:15,type:"pill"},{col:16,type:"pill"},{col:17,type:"pill"},{col:18,type:"wall"}]},{row:11,posX:[{col:1,type:"wall"},{col:2,type:"pill"},{col:3,type:"wall"},{col:4,type:"pill"},{col:5,type:"pill"},{col:6,type:"pill"},{col:7,type:"pill"},{col:8,type:"wall"},{col:9,type:"wall"},{col:10,type:"wall"},{col:11,type:"wall"},{col:12,type:"pill"},{col:13,type:"pill"},{col:14,type:"pill"},{col:15,type:"pill"},{col:16,type:"wall"},{col:17,type:"pill"},{col:18,type:"wall"}]},{row:12,posX:[{col:1,type:"wall"},{col:2,type:"powerpill"},{col:3,type:"pill"},{col:4,type:"pill"},{col:5,type:"wall"},{col:6,type:"wall"},{col:7,type:"pill"},{col:8,type:"pill"},{col:9,type:"pill"},{col:10,type:"pill"},{col:11,type:"pill"},{col:12,type:"pill"},{col:13,type:"wall"},{col:14,type:"wall"},{col:15,type:"pill"},{col:16,type:"pill"},{col:17,type:"powerpill"},{col:18,type:"wall"}]},{row:13,posX:[{col:1,type:"wall"},{col:2,type:"wall"},{col:3,type:"wall"},{col:4,type:"wall"},{col:5,type:"wall"},{col:6,type:"wall"},{col:7,type:"wall"},{col:8,type:"wall"},{col:9,type:"wall"},{col:10,type:"wall"},{col:11,type:"wall"},{col:12,type:"wall"},{col:13,type:"wall"},{col:14,type:"wall"},{col:15,type:"wall"},{col:16,type:"wall"},{col:17,type:"wall"},{col:18,type:"wall"}]}]};var b=0;$.each(this.map.posY,function(){$.each(this.posX,function(){"pill"==this.type&&b++})}),this.pillCount=b,0==a&&(this.score.set(0),this.score.refresh(".score"),q.lives=3,y.level=1,y.gameOver=!1),q.reset(),y.drawHearts(q.lives),this.ghostFrightened=!1,this.ghostFrightenedTimer=240,this.ghostMode=0,this.ghostModeTimer=200,null==E?(E=new o("pinky",7,5,"imgs/pinky.svg",2,2),B=new o("inky",8,5,"imgs/inky.svg",13,11),C=new o("blinky",9,5,"imgs/blinky.svg",13,0),D=new o("clyde",10,5,"imgs/clyde.svg",2,11)):(E.reset(),B.reset(),C.reset(),D.reset()),C.start(),B.start(),E.start(),D.start()},this.check=function(){0==this.pillCount&&y.running&&this.nextLevel()},this.win=function(){},this.gameover=function(){},this.toPixelPos=function(a){return 30*a},this.toGridPos=function(a){return a%30/30}}function l(){this.score=0,this.set=function(a){this.score=a},this.add=function(a){this.score+=a},this.refresh=function(a){G=new Date;var b=Math.round(1e3/(G-H));$(a).html("FPS: "+b),H=G}}function m(a,b,c,d,e){this.name=a,this.angle1=b,this.angle2=c,this.dirX=d,this.dirY=e,this.equals=function(a){return JSON.stringify(this)==JSON.stringify(a)}}function n(){this.dir=null,this.set=function(a){this.dir=a},this.get=function(){return this.dir}}function o(a,b,c,d,e,f){this.name=a,this.posX=30*b,this.posY=30*c,this.startPosX=30*b,this.startPosY=30*c,this.gridBaseX=e,this.gridBaseY=f,this.speed=5,this.images=JSON.parse('{"normal" : {"inky" : "0","pinky" : "1","blinky" : "2","clyde" : "3"},"frightened1" : {"left" : "", "up": "", "right" : "", "down": ""},"frightened2" : {"left" : "", "up": "", "right" : "", "down": ""},"dead" : {"left" : "", "up": "", "right" : "", "down": ""}}'),this.image=new Image,this.image.src=d,this.ghostHouse=!0,this.dazzled=!1,this.dazzle=function(){this.changeSpeed(3),this.posX>0&&(this.posX=this.posX-this.posX%this.speed),this.posY>0&&(this.posY=this.posY-this.posY%this.speed),this.dazzled=!0},this.undazzle=function(){this.dead||this.changeSpeed(3),this.posX>0&&(this.posX=this.posX-this.posX%this.speed),this.posY>0&&(this.posY=this.posY-this.posY%this.speed),this.dazzled=!1},this.dazzleImg=new Image,this.dazzleImg.src="imgs/dazzled.svg",this.dazzleImg2=new Image,this.dazzleImg2.src="imgs/dazzled2.svg",this.deadImg=new Image,this.deadImg.src="imgs/dead.svg",this.direction=M,this.radius=q.radius,this.draw=function(a){this.dead?a.drawImage(this.deadImg,this.posX,this.posY,2*this.radius,2*this.radius):this.dazzled?q.beastModeTimer<50&&q.beastModeTimer%8>1?a.drawImage(this.dazzleImg2,this.posX,this.posY,2*this.radius,2*this.radius):a.drawImage(this.dazzleImg,this.posX,this.posY,2*this.radius,2*this.radius):a.drawImage(this.image,this.posX,this.posY,2*this.radius,2*this.radius)},this.getCenterX=function(){return this.posX+this.radius},this.getCenterY=function(){return this.posY+this.radius},this.reset=function(){this.dead=!1,this.posX=this.startPosX,this.posY=this.startPosY,this.ghostHouse=!0,this.undazzle()},this.die=function(){this.dead=!0,this.changeSpeed(5)},this.changeSpeed=function(a){this.posX=Math.round(this.posX/a)*a,this.posY=Math.round(this.posY/a)*a,this.speed=a},this.move=function(){this.checkDirectionChange(),this.checkCollision(),1==this.ghostHouse&&("clyde"==this.name&&(this.stop=y.pillCount>104/3?!0:!1),"inky"==this.name&&(this.stop=y.pillCount>74?!0:!1),5==this.getGridPosY()&&this.inGrid()&&(7==this.getGridPosX()&&this.setDirection(M),(8==this.getGridPosX()||9==this.getGridPosX())&&this.setDirection(J),10==this.getGridPosX()&&this.setDirection(K)),4!=this.getGridPosY()||8!=this.getGridPosX()&&9!=this.getGridPosX()||!this.inGrid()||(console.log("ghosthouse -> false"),this.ghostHouse=!1)),this.stop||(this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=y.width-this.radius&&(this.posX=this.speed-this.radius),this.posX<=0-this.radius&&(this.posX=y.width-this.speed-this.radius),this.posY>=y.height-this.radius&&(this.posY=this.speed-this.radius),this.posY<=0-this.radius&&(this.posY=y.height-this.speed-this.radius))},this.checkCollision=function(){this.dead&&this.getGridPosX()==this.startPosX/30&&this.getGridPosY()==this.startPosY/30?this.reset():j(q.getCenterX(),this.getCenterX()-10,this.getCenterX()+10)&&j(q.getCenterY(),this.getCenterY()-10,this.getCenterY()+10)&&(this.dazzled||this.dead?(this.die(),y.score.add(100)):q.die())},this.getNextDirection=function(){function a(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0}var b=this.getGridPosX(),c=this.getGridPosY();y.getMapContent(b,c);var d;if(this.dead)var e=this.startPosX/30,f=this.startPosY/30;else if(0==y.ghostMode)var e=this.gridBaseX,f=this.gridBaseY;else if(1==y.ghostMode)switch(this.name){case"pinky":var g=q.direction,h=0==g.dirX?-g.dirY:g.dirX,i=0==g.dirY?-g.dirX:g.dirY,e=(q.getGridPosX()+4*h)%(y.width/q.radius+1),f=(q.getGridPosY()+4*i)%(y.height/q.radius+1);break;case"blinky":var e=q.getGridPosX(),f=q.getGridPosY();break;case"inky":var e=q.getGridPosX()+2*q.direction.dirX,f=q.getGridPosY()+2*q.direction.dirY,j=e-C.getGridPosX(),k=f-C.getGridPosY();e=Math.abs(C.getGridPosX()+2*j),f=Math.abs(C.getGridPosY()+2*k);break;case"clyde":var e=q.getGridPosX(),f=q.getGridPosY(),l=Math.sqrt(Math.pow(b-e,2)+Math.pow(c-f,2));5>l&&(e=this.gridBaseX,f=this.gridBaseY)}var m=(this.getOppositeDirection(),[{},{},{},{}]);m[0].field=y.getMapContent(b,c-1),m[0].dir=J,m[0].distance=Math.sqrt(Math.pow(b-e,2)+Math.pow(c-1-f,2)),m[1].field=y.getMapContent(b,c+1),m[1].dir=L,m[1].distance=Math.sqrt(Math.pow(b-e,2)+Math.pow(c+1-f,2)),m[2].field=y.getMapContent(b+1,c),m[2].dir=M,m[2].distance=Math.sqrt(Math.pow(b+1-e,2)+Math.pow(c-f,2)),m[3].field=y.getMapContent(b-1,c),m[3].dir=K,m[3].distance=Math.sqrt(Math.pow(b-1-e,2)+Math.pow(c-f,2));var n=m.sort(a),d=this.dir;if(this.dead)for(var o=n.length-1;o>=0;o--)"wall"==n[o].field||n[o].dir.equals(this.getOppositeDirection())||(d=n[o].dir);else for(var o=n.length-1;o>=0;o--)"wall"==n[o].field||"door"==n[o].field||n[o].dir.equals(this.getOppositeDirection())||(d=n[o].dir);return this.directionWatcher.set(d),d},this.setRandomDirection=function(){var a=Math.floor(10*Math.random()+1)%5;switch(a){case 1:this.setDirection(this.getOppositeDirection().equals(J)?L:J);break;case 2:this.setDirection(this.getOppositeDirection().equals(L)?J:L);break;case 3:this.setDirection(this.getOppositeDirection().equals(M)?K:M);break;case 4:this.setDirection(this.getOppositeDirection().equals(K)?M:K)}},this.reverseDirection=function(){console.log("reverseDirection: "+this.direction.name+" to "+this.getOppositeDirection().name),this.directionWatcher.set(this.getOppositeDirection())}}function p(){this.posX,this.posY,this.speed,this.dirX=M.dirX,this.dirY=M.dirY,this.direction,this.stop=!0,this.directionWatcher=new n,this.getNextDirection=function(){console.log("Figure getNextDirection")},this.checkDirectionChange=function(){this.inGrid()&&null==this.directionWatcher.get()&&this.getNextDirection(),null!=this.directionWatcher.get()&&this.inGrid()&&(this.setDirection(this.directionWatcher.get()),this.directionWatcher.set(null))},this.inGrid=function(){return this.posX%(2*this.radius)===0&&this.posY%(2*this.radius)===0?!0:!1},this.getOppositeDirection=function(){return this.direction.equals(J)?L:this.direction.equals(L)?J:this.direction.equals(M)?K:this.direction.equals(K)?M:void 0},this.move=function(){this.stop||(this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=y.width-this.radius&&(this.posX=this.speed-this.radius),this.posX<=0-this.radius&&(this.posX=y.width-this.speed-this.radius),this.posY>=y.height-this.radius&&(this.posY=this.speed-this.radius),this.posY<=0-this.radius&&(this.posY=y.height-this.speed-this.radius))},this.stop=function(){this.stop=!0},this.start=function(){this.stop=!1},this.getGridPosX=function(){return(this.posX-this.posX%30)/30},this.getGridPosY=function(){return(this.posY-this.posY%30)/30},this.setDirection=function(a){this.dirX=a.dirX,this.dirY=a.dirY,this.angle1=a.angle1,this.angle2=a.angle2,this.direction=a},this.setPosition=function(a,b){this.posX=a,this.posY=b}}function q(){this.radius=15,this.posX=0,this.posY=12*this.radius,this.speed=5,this.angle1=.25,this.angle2=1.75,this.mouth=1,this.dirX=M.dirX,this.dirY=M.dirY,this.lives=3,this.stuckX=0,this.stuckY=0,this.frozen=!1,this.freeze=function(){this.frozen=!0},this.unfreeze=function(){this.frozen=!1},this.getCenterX=function(){return this.posX+this.radius},this.getCenterY=function(){return this.posY+this.radius},this.directionWatcher=new n,this.direction=M,this.beastMode=!1,this.beastModeTimer=0,this.checkCollisions=function(){if(0==this.stuckX&&0==this.stuckY&&0==this.frozen){var a=this.getGridPosX(),b=this.getGridPosY(),c=a,d=b,e=y.getMapContent(a,b);1==this.dirX&&17>c&&(c+=1),1==this.dirY&&12>d&&(d+=1);var f=y.getMapContent(c,d);if(("pill"===e||"powerpill"===e)&&(1==this.dirX&&j(this.posX,y.toPixelPos(a)+this.radius-5,y.toPixelPos(a+1))||-1==this.dirX&&j(this.posX,y.toPixelPos(a),y.toPixelPos(a)+5)||1==this.dirY&&j(this.posY,y.toPixelPos(b)+this.radius-5,y.toPixelPos(b+1))||-1==this.dirY&&j(this.posY,y.toPixelPos(b),y.toPixelPos(b)+5)||"wall"===f)){var g;"powerpill"===e?(I.play("powerpill"),g=50,this.enableBeastMode(),y.startGhostFrightened()):(I.play("waka"),g=10,y.pillCount--),y.map.posY[b].posX[a].type="null",y.score.add(g)}("wall"===f||"door"===f)&&(this.stuckX=this.dirX,this.stuckY=this.dirY,q.stop(),1==this.stuckX&&this.posX%2*this.radius!=0&&(this.posX-=5),1==this.stuckY&&this.posY%2*this.radius!=0&&(this.posY-=5),-1==this.stuckX&&(this.posX+=5),-1==this.stuckY&&(this.posY+=5))}},this.checkDirectionChange=function(){if(null!=this.directionWatcher.get())if(1==this.stuckX&&this.directionWatcher.get()==M)this.directionWatcher.set(null);else if(this.stuckX=0,this.stuckY=0,this.inGrid()){console.log("x: "+this.getGridPosX()+" + "+this.directionWatcher.get().dirX),console.log("y: "+this.getGridPosY()+" + "+this.directionWatcher.get().dirY);var a=this.getGridPosX()+this.directionWatcher.get().dirX,b=this.getGridPosY()+this.directionWatcher.get().dirY;-1>=a&&(a=y.width/(2*this.radius)-1),a>=y.width/(2*this.radius)&&(a=0),-1>=b&&(a=y.height/(2*this.radius)-1),b>=y.heigth/(2*this.radius)&&(b=0),console.log("x: "+a),console.log("y: "+b);var c=y.map.posY[b].posX[a].type;console.log("checkNextTile: "+c),"wall"!=c&&(this.setDirection(this.directionWatcher.get()),this.directionWatcher.set(null))}},this.setDirection=function(a){this.frozen||(this.dirX=a.dirX,this.dirY=a.dirY,this.angle1=a.angle1,this.angle2=a.angle2,this.direction=a)},this.enableBeastMode=function(){this.beastMode=!0,this.beastModeTimer=240,B.dazzle(),E.dazzle(),C.dazzle(),D.dazzle()},this.disableBeastMode=function(){this.beastMode=!1,B.undazzle(),E.undazzle(),C.undazzle(),D.undazzle()},this.move=function(){this.frozen?this.dieAnimation():(this.beastModeTimer>0&&this.beastModeTimer--,0==this.beastModeTimer&&1==this.beastMode&&this.disableBeastMode(),this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=y.width-this.radius&&(this.posX=5-this.radius),this.posX<=0-this.radius&&(this.posX=y.width-5-this.radius),this.posY>=y.height-this.radius&&(this.posY=5-this.radius),this.posY<=0-this.radius&&(this.posY=y.height-5-this.radius))},this.eat=function(){if(!this.frozen&&this.dirX==this.dirY==0){this.angle1-=.07*this.mouth,this.angle2+=.07*this.mouth;var a=this.direction.angle1,b=this.direction.angle2,c=this.direction.angle1-.21,d=this.direction.angle2+.21;(this.angle1<c||this.angle2>d)&&(this.mouth=-1),(this.angle1>=a||this.angle2<=b)&&(this.mouth=1)}},this.stop=function(){this.dirX=0,this.dirY=0},this.reset=function(){this.unfreeze(),this.posX=0,this.posY=12*this.radius,this.setDirection(M),this.stop(),this.stuckX=0,this.stuckY=0},this.dieAnimation=function(){this.angle1+=.05,this.angle2-=.05,(this.angle1>=this.direction.angle1+.7||this.angle2<=this.direction.angle2-.7)&&this.dieFinal()},this.die=function(){I.play("die"),this.freeze(),this.dieAnimation()},this.dieFinal=function(){if(this.reset(),E.reset(),B.reset(),C.reset(),D.reset(),this.lives--,console.log("pacman died, "+this.lives+" lives left"),this.lives<=0){var a="<div id='highscore-form'><input type='text' id='playerName'/><span class='button' id='score-submit' onClick='addHighscore();'>save</span></div>";y.showMessage("Game over","Total Score: "+y.score.score+a),y.gameOver=!0,$("#playerName").focus()}y.drawHearts(this.lives)},this.getGridPosX=function(){return(this.posX-this.posX%30)/30},this.getGridPosY=function(){return(this.posY-this.posY%30)/30}}function r(){console.log("check AppCache"),window.applicationCache.addEventListener("updateready",function(){console.log("AppCache: updateready"),window.applicationCache.status==window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),confirm("A new version of this site is available. Load it?")&&window.location.reload())},!1),window.applicationCache.addEventListener("cached",function(){console.log("AppCache: cached")},!1)}function s(){console.log("hide adressbar"),$("html").scrollTop(1),$("body").scrollTop(1)}function t(){y.score.refresh(".score"),void 0==x&&(x=window.tmpcanvas.getContext("2d")),x.beginPath(),x.fillStyle="White",x.strokeStyle="White";var a;$.each(y.map.posY,function(){a=this.row,$.each(this.posX,function(){"pill"==this.type?(x.arc(y.toPixelPos(this.col-1)+q.radius,y.toPixelPos(a-1)+q.radius,q.radius/5,0*Math.PI,2*Math.PI),x.moveTo(y.toPixelPos(this.col-1),y.toPixelPos(a-1))):"powerpill"==this.type&&(x.arc(y.toPixelPos(this.col-1)+q.radius,y.toPixelPos(a-1)+q.radius,q.radius/3,0*Math.PI,2*Math.PI),x.moveTo(y.toPixelPos(this.col-1),y.toPixelPos(a-1)))})}),x.fill(),x.drawImage(z,0,0),1==y.running&&(E.draw(x),C.draw(x),B.draw(x),D.draw(x),x.beginPath(),x.fillStyle="Yellow",x.strokeStyle="Yellow",x.arc(q.posX+q.radius,q.posY+q.radius,q.radius,q.angle1*Math.PI,q.angle2*Math.PI),x.lineTo(q.posX+q.radius,q.posY+q.radius),x.stroke(),x.fill())}function u(){void 0===w&&(w=window.tmpcanvas),w.width=w.width,t(),1==y.dieAnimation&&q.dieAnimation(),1!=y.pause&&(q.move(),q.eat(),q.checkDirectionChange(),q.checkCollisions(),C.move(),B.move(),E.move(),D.move(),y.checkGhostMode()),y.check(),setTimeout(u,y.refreshRate)}function v(a){switch(a.keyCode){case 38:a.preventDefault();case 87:q.directionWatcher.set(J);break;case 40:a.preventDefault();case 83:q.directionWatcher.set(L);break;case 37:a.preventDefault();case 65:q.directionWatcher.set(K);break;case 39:a.preventDefault();case 68:q.directionWatcher.set(M);break;case 78:$("#playerName").is(":focus")||(y.pause=1,y.newGame());break;case 77:y.toggleSound();break;case 8:case 27:$("#playerName").is(":focus")||(a.preventDefault(),y.showContent("game-content"));break;case 32:a.preventDefault(),1!=y.gameOver&&$("#game-content").is(":visible")&&y.pauseResume();break;case 13:$("#game-content").is(":visible")&&h()}}d(realTimeSimpleService),console.log(realTimeSimpleService),console.log("1231231"),console.log(window.parent===window),isOngoing=!1;var w,x,y,z,A,B,C,D,E,F=function(){var a=null,b={};return b.enableLogger=function(){null!=a&&(window.console.log=a)},b.disableLogger=function(){a=console.log,window.console.log=function(){}},b}();y=new k;var G=new Date,H=new Date,I=new Object;I.play=function(a){if(1==y.soundfx){var b=document.getElementById(a);null!=b?b.play():console.log(a+" not found")}};var J=new m("up",1.75,1.25,0,-1),K=new m("left",1.25,.75,-1,0),L=new m("down",.75,.25,0,1),M=new m("right",.25,1.75,1,0);o.prototype=new p,q.prototype=new p;var q=new q;z=document.createElement("canvas"),z.width=y.canvas.width,z.height=y.canvas.height,A=z.getContext("2d"),A.fillStyle="Blue",A.strokeStyle="Blue",i(A,0,0,18,1),i(A,0,12,18,1),i(A,0,0,1,6),i(A,0,7,1,6),i(A,17,0,1,6),i(A,17,7,1,6),i(A,7,4,1,1),i(A,6,5,1,2),i(A,10,4,1,1),i(A,11,5,1,2),i(A,6,6,6,1),A.fillRect(16*q.radius,q.radius/2+8*q.radius+5,4*q.radius,1),i(A,4,0,1,2),i(A,13,0,1,2),i(A,2,2,1,2),i(A,6,2,2,1),i(A,15,2,1,2),i(A,10,2,2,1),i(A,2,3,2,1),i(A,14,3,2,1),i(A,5,3,1,1),i(A,12,3,1,1),i(A,3,3,1,3),i(A,14,3,1,3),i(A,3,4,1,1),i(A,14,4,1,1),i(A,0,5,2,1),i(A,3,5,2,1),i(A,16,5,2,1),i(A,13,5,2,1),i(A,0,7,2,2),i(A,16,7,2,2),i(A,3,7,2,2),i(A,13,7,2,2),i(A,4,8,2,2),i(A,12,8,2,2),i(A,5,8,3,1),i(A,10,8,3,1),i(A,2,10,1,1),i(A,15,10,1,1),i(A,7,10,4,1),i(A,4,11,2,2),i(A,12,11,2,2),$(document).ready(function(){$.ajaxSetup({mimeType:"application/json"}),$.ajaxSetup({beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")}}),s(),null!=window.applicationCache&&r(),window.addEventListener("keydown",v,!0),$("#canvas-container").click(function(){1!=y.gameOver&&y.pauseResume()}),Hammer(".container").on("swiperight",function(a){$("#game-content").is(":visible")&&(a.gesture.preventDefault(),q.directionWatcher.set(M))}),Hammer(".container").on("swipeleft",function(a){$("#game-content").is(":visible")&&(a.gesture.preventDefault(),q.directionWatcher.set(K))}),Hammer(".container").on("swipeup",function(a){$("#game-content").is(":visible")&&(a.gesture.preventDefault(),q.directionWatcher.set(J))}),Hammer(".container").on("swipedown",function(a){$("#game-content").is(":visible")&&(a.gesture.preventDefault(),q.directionWatcher.set(L))}),$(document).on("touchend mousedown","#up",function(a){a.preventDefault(),q.directionWatcher.set(J)}),$(document).on("touchend mousedown","#down",function(a){a.preventDefault(),q.directionWatcher.set(L)}),$(document).on("touchend mousedown","#left",function(a){a.preventDefault(),q.directionWatcher.set(K)}),$(document).on("touchend mousedown","#right",function(a){a.preventDefault(),q.directionWatcher.set(M)}),$(document).on("click",".button#newGame",function(){y.newGame()}),$(document).on("click",".button#highscore",function(){y.showContent("highscore-content"),e()}),$(document).on("click",".button#instructions",function(){y.showContent("instructions-content")}),$(document).on("click",".button#info",function(){y.showContent("info-content")}),$(document).on("click",".button#back",function(){y.showContent("game-content")}),$(document).on("click",".controlSound",function(){y.toggleSound()}),$(document).on("click","#updateCode",function(a){a.preventDefault(),window.applicationCache.update()}),w=$("#myCanvas").get(0),x=w.getContext("2d"),window.tmpcontext=x,y.init(0),F.disableLogger(),t()})}]);
//# sourceMappingURL=gameSetting.min.js.map